import{r as i,b as D,j as e,T as l,d as r,A as O,R as M,h as P,v as $,g as W,s as g,o as N,p as A,u as I,a as L}from"./index-BuheAWnM.js";const z=({onSubmit:d,productId:s,open:S,onClose:u})=>{const[h,v]=i.useState(0),[n,m]=i.useState([]),[k,x]=i.useState(""),[p,b]=i.useState(""),[T,V]=i.useState(null),[w,f]=i.useState(""),j=D(),R=async()=>{try{j(g(!0));const a=await N.getReview(s);m(a.data.reviews||[]),j(g(!1))}catch(a){j(g(!1)),A(a)}};i.useEffect(()=>{R()},[s]);const y=()=>setOpen(!0),_=()=>{setOpen(!1),C()},C=()=>{v(0),x(""),b(""),V(null),f("")},t=()=>{if(h===0){f("Please select a star rating.");return}if(!p.trim()){f("Please provide a description.");return}const a={user_id:"67614ed48f4328508f0c89f4",user_name:"Anjana",review_title:k,review_description:p,ratings:h,uploaded_image:T};m(o=>[a,...o]),d&&d(a),_()},c=()=>{const a=n.length;return[5,4,3,2,1].map(B=>{const E=n.filter(F=>F.ratings===B).length;return{star:B,count:E,percentage:a?E/a*100:0}})};return n.filter(a=>a.uploaded_image).map(a=>a.uploaded_image),e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"h5",sx:{textAlign:"center",marginBottom:"1rem"},children:"Customer Reviews"}),e.jsxs(r,{sx:{width:"100%",margin:"auto",padding:"2rem",backgroundColor:"#f9f9f9",borderRadius:"8px",display:"flex"},children:[e.jsxs(r,{sx:{marginBottom:"2rem"},children:[e.jsx(l,{variant:"h6",sx:{marginBottom:"1rem"},children:n.length>0?`${(n.reduce((a,o)=>a+o.ratings,0)/n.length).toFixed(1)} out of 5`:"No ratings yet"}),c().map(a=>e.jsxs(r,{sx:{display:"flex",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsxs(l,{variant:"body2",sx:{minWidth:"50px"},children:[a.star," star"]}),e.jsx(r,{sx:{flex:1,backgroundColor:"#e0e0e0",height:"10px",borderRadius:"5px",marginX:"0.5rem",width:"20rem",marginLeft:"119px"},children:e.jsx(r,{sx:{width:`${a.percentage}%`,backgroundColor:"#ffc107",height:"10px",borderRadius:"5px"}})}),e.jsx(l,{variant:"body2",children:a.count})]},a.star))]}),n.length>0?e.jsx(r,{children:n.map((a,o)=>e.jsxs(r,{sx:{display:"flex",flexDirection:"row",gap:"1rem",padding:"1rem",borderBottom:"1px solid #e0e0e0",width:"52rem",marginLeft:"50px"},className:"hello",children:[e.jsx(O,{children:a.user_name[0]}),e.jsxs(r,{children:[e.jsx(l,{variant:"subtitle1",fontWeight:"bold",children:a.user_name}),e.jsx(M,{value:a.ratings,readOnly:!0,size:"small"}),e.jsx(l,{variant:"body2",children:a.review_title}),e.jsx(l,{variant:"body2",color:"text.secondary",children:a.review_description}),a.uploaded_image&&e.jsx(r,{component:"img",src:a.uploaded_image,alt:"Review",sx:{width:"100px",height:"100px",borderRadius:"8px",marginTop:"0.5rem"}})]})]},o))}):e.jsx(l,{variant:"p",sx:{margin:"0 auto"},children:"No reviews yet."})]}),e.jsx(P,{variant:"contained",onClick:y,sx:{display:"block",margin:"2rem auto",backgroundColor:"#c026d3",color:"#fff",textTransform:"none","&:hover":{backgroundColor:"#9b1a99"}},children:"Write a Review"}),e.jsx($,{open:S,onClose:u,"aria-labelledby":"review-modal-title","aria-describedby":"review-modal-description",children:e.jsxs(r,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:450,bgcolor:"background.paper",borderRadius:3,boxShadow:24,p:3,display:"flex",flexDirection:"column",gap:3},children:[e.jsx(l,{id:"review-modal-title",variant:"h6",sx:{fontWeight:"bold",textAlign:"center"},children:"Write a Review"}),e.jsx(M,{name:"rating",value:h,onChange:(a,o)=>v(o),sx:{alignSelf:"center",marginBottom:"1rem"}}),e.jsx(W,{label:"Review Title",variant:"outlined",fullWidth:!0,value:k,onChange:a=>x(a.target.value),sx:{backgroundColor:"#fafafa",borderRadius:"8px"}}),e.jsx(W,{label:"Review Content",variant:"outlined",multiline:!0,rows:4,fullWidth:!0,value:p,onChange:a=>b(a.target.value),sx:{backgroundColor:"#fafafa",borderRadius:"8px"}}),w&&e.jsx(l,{color:"error",variant:"body2",sx:{textAlign:"center"},children:w}),e.jsx(P,{variant:"contained",color:"primary",onClick:t,sx:{backgroundColor:"#c026d3",color:"#fff",borderRadius:"20px",textTransform:"none",padding:"12px 25px","&:hover":{backgroundColor:"#388e3c"}},children:"Submit Review"})]})})]})},X=()=>{var R,y,_,C;const{id:d}=I(),[s,S]=i.useState(null),[u,h]=i.useState([]),[v,n]=i.useState(!1),[m,k]=i.useState(null),x=D(),p=L(),b=t=>!t||t.length===0?0:(t.reduce((a,o)=>a+o.ratings,0)/t.length).toFixed(1),T=async()=>{try{x(g(!0));const t=await N.getVendorProfile(d),c=t.data;console.log(t.data),c.rating=b(c.Reviews),S(c),x(g(!1))}catch(t){A(t)}finally{x(g(!1))}},V=async()=>{try{const t=await N.getParticularVendorProduct(d);console.log(t.data[0]._id),h(t.data)}catch(t){A(t)}},w=()=>{n(!0)};console.log("The id check",d);const f=async t=>{await N.writeVendorReview(t,d),n(!1)},j=t=>{p(`/products/${t}`)};return i.useEffect(()=>{T(),V()},[d]),m?e.jsx(r,{className:"error",children:m}):e.jsx(r,{className:"vendor-container",children:s&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{className:"vendor-header",children:[e.jsxs(r,{className:"vendor-image",sx:{position:"relative"},children:[e.jsx(P,{onClick:w,sx:{position:"absolute",top:"3rem",left:"30rem"},children:"Review"}),e.jsx("img",{src:s.shop_image_or_logo||"/assets/vendor-logo.png",alt:"Vendor Logo",className:"vendor-logo"})]}),e.jsxs(r,{className:"vendor-info",children:[e.jsx("h2",{children:s.vendor_name}),e.jsxs("p",{children:[" Mobile: ",s.mobile_number]}),e.jsx("p",{children:(R=s==null?void 0:s.address[0])==null?void 0:R.roadArea}),e.jsx("p",{children:(y=s==null?void 0:s.address[0])==null?void 0:y.cityDownVillage}),e.jsxs("p",{children:[(_=s==null?void 0:s.address[0])==null?void 0:_.distric,", ",(C=s==null?void 0:s.address[0])==null?void 0:C.state]}),e.jsxs(r,{className:"vendor-rating",children:[[...Array(5)].map((t,c)=>e.jsx("span",{className:`star ${c<Math.floor(s.rating||0)?"filled":""}`,children:"★"},c)),e.jsx("span",{className:"rating-value",children:s.rating?`${s.rating}/5`:"No Ratings"})]})]})]}),e.jsxs(r,{className:"items-section",children:[e.jsx("h3",{children:"✨ ITEMS ✨"}),e.jsx(r,{className:"items-grid",children:u==null?void 0:u.map(t=>e.jsxs(r,{className:"item-card",onClick:()=>j(t._id),children:[e.jsx(r,{className:"item-image",children:e.jsx("img",{src:t.product_image||"/assets/default-item.png",alt:t.title})}),e.jsxs(r,{className:"item-info",children:[e.jsx("h4",{children:t.product_name}),e.jsxs("p",{children:["₹",t.product_price]})]})]},t._id))})]}),e.jsx(z,{onSubmit:f,productId:d,open:v,onClose:()=>n(!1)})]})})};export{X as default};
